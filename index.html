<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f6f9;
      margin: 0;
    }

    header {
      background-color: #004080;
      color: white;
      padding: 16px;
      text-align: center;
      font-size: 1.3rem;
    }

    .container {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
    }

    video, img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      margin-bottom: 10px;
    }

    .btn {
      margin-top: 10px;
      padding: 10px 16px;
      font-size: 1rem;
      background: #0070cc;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .btn:hover {
      background: #005bb5;
    }

    .info {
      margin-top: 12px;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <header>üì∑ –ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</header>
  <div class="container" id="app"></div>

  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ React 17 + Babel + React Webcam -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://unpkg.com/react-webcam@7.0.1/dist/react-webcam.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;
    const Webcam = window["react-webcam"];

    function CameraApp() {
      const webcamRef = useRef(null);
      const [image, setImage] = useState(null);
      const [geo, setGeo] = useState(null);
      const [showCamera, setShowCamera] = useState(false);

      const videoConstraints = {
        facingMode: { exact: "environment" }
      };

      useEffect(() => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const { latitude, longitude } = position.coords;
              setGeo({ latitude, longitude });
            },
            (error) => {
              console.error("–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:", error);
              alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.");
            }
          );
        }
      }, []);

      const startCamera = () => {
        setShowCamera(true);
      };

      const takePhoto = () => {
        const screenshot = webcamRef.current.getScreenshot();
        setImage(screenshot);
      };

      const downloadImage = () => {
        if (!image) return;
        const a = document.createElement('a');
        a.href = image;
        a.download = 'snapshot.png';
        a.click();
      };

      return (
        <div>
          {!showCamera ? (
            <button className="btn" onClick={startCamera}>üé• –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
          ) : (
            <div>
              <Webcam
                ref={webcamRef}
                audio={false}
                screenshotFormat="image/png"
                videoConstraints={videoConstraints}
              />
              <button className="btn" onClick={takePhoto}>üì∏ –°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫</button>
            </div>
          )}

          {image && (
            <div>
              <img src={image} alt="–°–Ω–∏–º–æ–∫" />
              <button className="btn" onClick={downloadImage}>üíæ –°–∫–∞—á–∞—Ç—å</button>
            </div>
          )}

          <div className="info">
            üåç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è:{" "}
            {geo
              ? `—à–∏—Ä–æ—Ç–∞: ${geo.latitude.toFixed(6)}, –¥–æ–ª–≥–æ—Ç–∞: ${geo.longitude.toFixed(6)}`
              : "–æ–ø—Ä–µ–¥–µ–ª—è–µ–º..."}
          </div>
        </div>
      );
    }

    ReactDOM.render(<CameraApp />, document.getElementById("app"));
  </script>
</body>
</html>
