<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background-color: #004080;
      color: white;
      padding: 16px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
      user-select: none;
    }

    .container {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 16px 40px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    video, img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      margin-bottom: 16px;
      object-fit: cover;
    }

    .btn-camera {
      background-color: #0070cc;
      border: none;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      cursor: pointer;
      color: white;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .btn-camera:hover {
      background-color: #005bb5;
    }

    .btn {
      background-color: #0070cc;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 16px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 10px;
      user-select: none;
    }
    .btn:hover {
      background-color: #005bb5;
    }

    .info {
      margin-top: 12px;
      font-size: 0.95rem;
      color: #333;
      user-select: none;
    }
  </style>
</head>
<body>
  <header>üì∑ –ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</header>
  <div class="container" id="app"></div>

  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function CameraApp() {
      const videoRef = useRef(null);
      const canvasRef = useRef(null);
      const [image, setImage] = useState(null);
      const [geo, setGeo] = useState(null);
      const [showCamera, setShowCamera] = useState(false);
      const [isFrontCamera, setIsFrontCamera] = useState(false);

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã
      const videoConstraints = {
        facingMode: isFrontCamera ? "user" : "environment"
      };

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
      const startCamera = () => {
        if (!videoRef.current) return;

        navigator.mediaDevices
          .getUserMedia({ video: videoConstraints })
          .then((stream) => {
            videoRef.current.srcObject = stream;
            setShowCamera(true);
          })
          .catch((err) => {
            console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ", err);
            alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ");
          });
      };

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
      const toggleCamera = () => {
        setIsFrontCamera((prevState) => !prevState);
        setShowCamera(false); // –û—Ç–∫–ª—é—á–∞–µ–º –∫–∞–º–µ—Ä—É
        startCamera(); // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–æ–≤—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º
      };

      // –°–Ω–∏–º–æ–∫ —Å –∫–∞–º–µ—Ä—ã
      const takePhoto = () => {
        const video = videoRef.current;
        const canvas = canvasRef.current;
        const ctx = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        const dataUrl = canvas.toDataURL("image/png");
        setImage(dataUrl);
      };

      // –°–∫–∞—á–∞—Ç—å —Å–Ω–∏–º–æ–∫
      const downloadImage = () => {
        if (!image) return;
        const a = document.createElement("a");
        a.href = image;
        a.download = "snapshot.png";
        a.click();
      };

      // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
      useEffect(() => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const { latitude, longitude } = position.coords;
              setGeo({ latitude, longitude });
            },
            (error) => {
              console.error("–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:", error);
              alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.");
            }
          );
        }
      }, []);

      return (
        <div>
          {!showCamera ? (
            <div style={{ display: "flex", justifyContent: "center", marginTop: 40 }}>
              <button
                className="btn-camera"
                onClick={startCamera}
                aria-label="–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"
                title="–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"
              >
                üì∑
              </button>
            </div>
          ) : (
            <div>
              <video ref={videoRef} autoPlay playsInline style={{ borderRadius: 8 }} />
              <div style={{ display: "flex", justifyContent: "center", marginTop: 20 }}>
                <button
                  className="btn-camera"
                  onClick={toggleCamera}
                  aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É"
                  title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É"
                >
                  üîÑ
                </button>
                <button
                  className="btn-camera"
                  onClick={takePhoto}
                  aria-label="–°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫"
                  title="–°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫"
                >
                  üì∏
                </button>
              </div>
            </div>
          )}

          {image && (
            <div>
              <img src={image} alt="–°–Ω–∏–º–æ–∫ —Å –∫–∞–º–µ—Ä—ã" />
              <div style={{ display: "flex", justifyContent: "center" }}>
                <button className="btn" onClick={downloadImage}>
                  üíæ –°–∫–∞—á–∞—Ç—å —Å–Ω–∏–º–æ–∫
                </button>
              </div>
            </div>
          )}

          <div className="info" style={{ textAlign: "center" }}>
            üåç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è:{" "}
            {geo
              ? `—à–∏—Ä–æ—Ç–∞: ${geo.latitude.toFixed(6)}, –¥–æ–ª–≥–æ—Ç–∞: ${geo.longitude.toFixed(6)}`
              : "–æ–ø—Ä–µ–¥–µ–ª—è–µ–º..."}
          </div>
        </div>
      );
    }

    ReactDOM.render(<CameraApp />, document.getElementById("app"));
  </script>
</body>
</html>
