<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</title>
  <style>
    /* —Å—Ç–∏–ª–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ */
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background-color: #004080;
      color: white;
      padding: 16px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
      user-select: none;
    }

    .container {
      max-width: 600px;
      margin: 20px auto;
      padding: 0 16px 40px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    video, img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      margin-bottom: 16px;
      object-fit: cover;
    }

    .btn-camera {
      background-color: #0070cc;
      border: none;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      cursor: pointer;
      color: white;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .btn-camera:hover {
      background-color: #005bb5;
    }

    .btn {
      background-color: #0070cc;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 16px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 10px;
      user-select: none;
    }
    .btn:hover {
      background-color: #005bb5;
    }

    .info {
      margin-top: 12px;
      font-size: 0.95rem;
      color: #333;
      user-select: none;
    }
  </style>
</head>
<body>
  <header>üì∑ –ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</header>
  <div class="container" id="app"></div>

  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://unpkg.com/react-webcam@7.0.1/dist/react-webcam.umd.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;
    const Webcam = window.ReactWebcam; // <-- –∑–¥–µ—Å—å

    function CameraApp() {
      const webcamRef = useRef(null);
      const [image, setImage] = useState(null);
      const [geo, setGeo] = useState(null);
      const [showCamera, setShowCamera] = useState(false);

      const videoConstraints = {
        facingMode: { exact: "environment" }
      };

      useEffect(() => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const { latitude, longitude } = position.coords;
              setGeo({ latitude, longitude });
            },
            (error) => {
              console.error("–û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:", error);
              alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.");
            }
          );
        }
      }, []);

      const startCamera = () => {
        setShowCamera(true);
      };

      const takePhoto = () => {
        if (!webcamRef.current) return;
        const screenshot = webcamRef.current.getScreenshot();
        if (screenshot) {
          setImage(screenshot);
        }
      };

      const downloadImage = () => {
        if (!image) return;
        const a = document.createElement('a');
        a.href = image;
        a.download = 'snapshot.png';
        a.click();
      };

      return (
        <div style={{width: "100%"}}>
          {!showCamera ? (
            <div style={{ display: 'flex', justifyContent: 'center', marginTop: 40 }}>
              <button
                className="btn-camera"
                onClick={startCamera}
                aria-label="–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"
                title="–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É"
              >
                üì∑
              </button>
            </div>
          ) : (
            <div>
              <Webcam
                ref={webcamRef}
                audio={false}
                screenshotFormat="image/png"
                videoConstraints={videoConstraints}
                style={{ borderRadius: 8, boxShadow: "0 2px 6px rgba(0,0,0,0.15)" }}
              />
              <div style={{ display: 'flex', justifyContent: 'center' }}>
                <button className="btn-camera" onClick={takePhoto} aria-label="–°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫" title="–°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫">
                  üì∏
                </button>
              </div>
            </div>
          )}

          {image && (
            <div>
              <img src={image} alt="–°–Ω–∏–º–æ–∫ —Å –∫–∞–º–µ—Ä—ã" />
              <div style={{ display: 'flex', justifyContent: 'center' }}>
                <button className="btn" onClick={downloadImage}>üíæ –°–∫–∞—á–∞—Ç—å —Å–Ω–∏–º–æ–∫</button>
              </div>
            </div>
          )}

          <div className="info" style={{ textAlign: "center" }}>
            üåç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è:{" "}
            {geo
              ? `—à–∏—Ä–æ—Ç–∞: ${geo.latitude.toFixed(6)}, –¥–æ–ª–≥–æ—Ç–∞: ${geo.longitude.toFixed(6)}`
              : "–æ–ø—Ä–µ–¥–µ–ª—è–µ–º..."}
          </div>
        </div>
      );
    }

    ReactDOM.render(<CameraApp />, document.getElementById("app"));
  </script>
</body>
</html>
