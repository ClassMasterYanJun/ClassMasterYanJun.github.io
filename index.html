<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (React Webcam)</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f4f6f9;
      color: #333;
    }

    header {
      background-color: #004080;
      color: white;
      padding: 16px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: bold;
    }

    .container {
      padding: 16px;
      max-width: 600px;
      margin: auto;
    }

    video, img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      margin-bottom: 10px;
    }

    .btn {
      display: inline-block;
      margin: 8px 4px;
      padding: 10px 16px;
      font-size: 1rem;
      color: white;
      background-color: #0070cc;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #005bb5;
    }

    .info {
      margin-top: 10px;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <header>üì∑ –ö–∞–º–µ—Ä–∞ –∏ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (React Webcam)</header>
  <div class="container" id="root"></div>

  <!-- React + Babel + React Webcam -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://unpkg.com/react-webcam@7.0.1/dist/react-webcam.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;
    const Webcam = window["react-webcam"];

    function App() {
      const webcamRef = useRef(null);
      const [imageURL, setImageURL] = useState(null);
      const [geo, setGeo] = useState(null);

      const videoConstraints = {
        facingMode: "environment"
      };

      useEffect(() => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => {
              const { latitude, longitude } = pos.coords;
              setGeo({ latitude, longitude });
            },
            (err) => {
              console.error("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è:", err);
              alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.");
            }
          );
        } else {
          alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.");
        }
      }, []);

      const capture = () => {
        const imageSrc = webcamRef.current.getScreenshot();
        setImageURL(imageSrc);
      };

      const downloadImage = () => {
        if (!imageURL) return;
        const a = document.createElement("a");
        a.href = imageURL;
        a.download = "snapshot.png";
        a.click();
      };

      return (
        <div>
          <Webcam
            ref={webcamRef}
            audio={false}
            screenshotFormat="image/png"
            videoConstraints={videoConstraints}
            style={{ borderRadius: "8px", width: "100%" }}
          />
          <button className="btn" onClick={capture}>üì∏ –°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫</button>
          {imageURL && (
            <div>
              <img src={imageURL} alt="–°–Ω–∏–º–æ–∫" />
              <button className="btn" onClick={downloadImage}>üíæ –°–∫–∞—á–∞—Ç—å</button>
            </div>
          )}
          <div className="info">
            üåç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è:{" "}
            {geo ? (
              <span>
                —à–∏—Ä–æ—Ç–∞: <b>{geo.latitude.toFixed(6)}</b>, –¥–æ–ª–≥–æ—Ç–∞: <b>{geo.longitude.toFixed(6)}</b>
              </span>
            ) : (
              "–ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã..."
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
